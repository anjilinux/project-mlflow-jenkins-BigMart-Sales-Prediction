Started by user anjireddy-jenkins

Obtained Jenkinsfile from git https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins
 in /var/lib/jenkins/workspace/bigmart
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/bigmart/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git # timeout=10
Fetching upstream changes from https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git
 > git --version # timeout=10
 > git --version # 'git version 2.43.0'
 > git fetch --tags --force --progress -- https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git +refs/heads/*:refs/remotes/origin/* # timeout=10

 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision 7d3b72bd22fdd32edc8f4260fa7a33bc4099707c (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 7d3b72bd22fdd32edc8f4260fa7a33bc4099707c # timeout=10
Commit message: "docker"
 > git rev-list --no-walk 94854a42598efa33a3681ab12e69ad60191371a1 # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Checkout Code)
[Pipeline] git
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/bigmart/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git # timeout=10
Fetching upstream changes from https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git
 > git --version # timeout=10
 > git --version # 'git version 2.43.0'
 > git fetch --tags --force --progress -- https://github.com/anjilinux/project-mlflow-jenkins-BigMart-Sales-Prediction.git +refs/heads/*:refs/remotes/origin/* # timeout=10

 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision 7d3b72bd22fdd32edc8f4260fa7a33bc4099707c (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 7d3b72bd22fdd32edc8f4260fa7a33bc4099707c # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D master # timeout=10
 > git checkout -b master 7d3b72bd22fdd32edc8f4260fa7a33bc4099707c # timeout=10
Commit message: "docker"
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Setup Virtual Environment)
[Pipeline] sh
+ python3 -m venv venv

+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ pip install -r requirements.txt
Requirement already satisfied: flask in ./venv/lib/python3.12/site-packages (from -r requirements.txt (line 1)) (3.1.2)
: pyasn1<0.7.0,>=0.6.1 in ./venv/lib/python3.12/site-packages (from pyasn1-modules>=0.2.1->google-auth~=2.0->databricks-sdk<1,>=0.20.0->mlflow-skinny==3.9.0->mlflow->-r requirements.txt (line 6)) (0.6.2)

[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Data Ingestion)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ python data_ingestion.py
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (EDA & Feature Engineering)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ python eda_feature_engineering.py

/var/lib/jenkins/workspace/bigmart/eda_feature_engineering.py:9: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  df["Item_Weight"].fillna(df["Item_Weight"].mean(), inplace=True)
/var/lib/jenkins/workspace/bigmart/eda_feature_engineering.py:10: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  df["Outlet_Size"].fillna(df["Outlet_Size"].mode()[0], inplace=True)
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Data Preprocessing)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ python preprocessing.py

[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Model Training)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ python train.py

2026/01/31 14:59:55 WARNING mlflow.models.model: `artifact_path` is deprecated. Please use `name` instead.
/var/lib/jenkins/workspace/bigmart/venv/lib/python3.12/site-packages/mlflow/models/model.py:1209: FutureWarning: Saving scikit-learn models in the pickle or cloudpickle format requires exercising caution because these formats rely on Python's object serialization mechanism, which can execute arbitrary code during deserialization.The recommended safe alternative is the 'skops' format.
  flavor.save_model(path=local_path, mlflow_model=mlflow_model, **kwargs)

ðŸƒ View run luxuriant-dove-740 at: http://localhost:5555/#/experiments/65/runs/4e62b132f280422c93ddbd8a9b993514
ðŸ§ª View experiment at: http://localhost:5555/#/experiments/65

[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Model Evaluation)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ python evaluate.py

RMSE: 924.6549929176826
R2: 0.41140176863414846
ðŸƒ View run wise-pig-397 at: http://localhost:5555/#/experiments/65/runs/e82d71c87abe4268b034b5dc0b6bb625
ðŸ§ª View experiment at: http://localhost:5555/#/experiments/65

[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Model Testing)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ pytest test_model.py

============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0
rootdir: /var/lib/jenkins/workspace/bigmart
plugins: anyio-4.12.1
collected 1 item


.                                                          [100%]

=============================== warnings summary ===============================
test_model.py::test_model_prediction
  /var/lib/jenkins/workspace/bigmart/venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2691: UserWarning: X does not have valid feature names, but RandomForestRegressor was fitted with feature names
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
========================= 1 passed, 1 warning in 1.32s =========================
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Prediction Test)
[Pipeline] sh
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ python predict.py

Model expects features in this order:
['Item_Identifier', 'Item_Weight', 'Item_Fat_Content', 'Item_Visibility', 'Item_Type', 'Item_MRP', 'Outlet_Identifier', 'Outlet_Establishment_Year', 'Outlet_Size', 'Outlet_Location_Type', 'Outlet_Type']
âœ… Prediction successful: [2425.762404]
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Prediction API Test)
[Pipeline] sh
+ set -e
+ trap kill -9 $FLASK_PID 2>/dev/null || true EXIT
+ echo Activating virtual environment...
Activating virtual environment...
+ . venv/bin/activate
+ deactivate nondestructive
+ [ -n  ]
+ [ -n  ]
+ hash -r
+ [ -n  ]
+ unset VIRTUAL_ENV
+ unset VIRTUAL_ENV_PROMPT
+ [ ! nondestructive = nondestructive ]
+ [  = cygwin ]
+ [  = msys ]
+ export VIRTUAL_ENV=/var/lib/jenkins/workspace/bigmart/venv
+ _OLD_VIRTUAL_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ PATH=/var/lib/jenkins/workspace/bigmart/venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/snap/bin
+ export PATH
+ [ -n  ]
+ [ -z  ]
+ _OLD_VIRTUAL_PS1=$ 
+ PS1=(venv) $ 
+ export PS1
+ VIRTUAL_ENV_PROMPT=(venv) 
+ export VIRTUAL_ENV_PROMPT
+ hash -r
+ PORT=5001
+ echo Checking if port 5001 is already in use...
Checking if port 5001 is already in use...
+ ss -lptn sport = :5001
+ awk -F, {print $2}
+ awk -F= {print $2}
+ PID=
+ [ -n  ]
+ echo Port 5001 is free.
Port 5001 is free.
+ echo Starting Flask API...
Starting Flask API...
+ FLASK_PID=644628
+ echo Flask PID: 644628
Flask PID: 644628
+ echo Waiting for Flask to be ready...
Waiting for Flask to be ready...
+ curl -sf http://localhost:5001/health
+ nohup python app.py
+ sleep 3

+ curl -sf http://localhost:5001/health
+ echo Sending prediction request...
Sending prediction request...
+ curl -s -X POST http://localhost:5001/predict -H Content-Type: application/json -d {"features":[1,2,3,4,5,6,7,2010,2,1,3]}
+ RESPONSE={"prediction":2483.8334800000016}
+ echo Prediction response: {"prediction":2483.8334800000016}
Prediction response: {"prediction":2483.8334800000016}
+ echo {"prediction":2483.8334800000016}
+ grep -qi error
+ echo Stopping Flask...
Stopping Flask...
+ kill -9 644628
+ echo Flask stopped cleanly.
Flask stopped cleanly.
+ kill -9 644628
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Docker Build & Run)
[Pipeline] sh
+ docker build -t bigmart-api .
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 216B done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/python:3.12-slim

#2 DONE 2.1s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/5] FROM docker.io/library/python:3.12-slim@sha256:5e2dbd4bbdd9c0e67412aea9463906f74a22c60f89eb7b5bbb7d45b66a2b68a6
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 128.80kB done
#5 DONE 0.0s

#6 [3/5] COPY requirements.txt .
#6 CACHED

#7 [4/5] RUN pip install --no-cache-dir -r requirements.txt
#7 CACHED

#8 [2/5] WORKDIR /app
#8 CACHED

#9 [5/5] COPY app.py model.pkl ./
#9 CACHED

#10 exporting to image
#10 exporting layers done
#10 writing image sha256:e5ca4a69c5df6445b62af61efd4f2dfeb8c82c26afb4be5d03bf1b39940be9b0 done
#10 naming to docker.io/library/bigmart-api done
#10 DONE 0.0s
+ docker run -d -p 5002:5001 --name bigmart-api bigmart-api

98819616e14722b7c3e832548b8158fca35e712594081c565d79fb5bc8d1485a
+ sleep 50

+ curl -sf http://localhost:5002/health
{"status":"UP"}
+ docker stop bigmart-api

bigmart-api
+ docker rm bigmart-api
bigmart-api
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Archive Artifacts)
[Pipeline] archiveArtifacts
Archiving artifacts
Recording fingerprints
[Pipeline] }
[Pipeline] // stage

[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] echo
âœ… BigMart MLOps Pipeline Completed Successfully
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
org.jenkinsci.plugins.scriptsecurity.scripts.UnapprovedUsageException: script not yet approved for use

	at java.base/java.lang.Thread.run(Thread.java:1583)
Finished: SUCCESS
